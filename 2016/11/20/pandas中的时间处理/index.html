<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>pandas中的时间处理 | 长海冰茶火</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">pandas中的时间处理</h1><a id="logo" href="/.">长海冰茶火</a><p class="description">很惭愧，做了一点微小的工作和笔记</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">pandas中的时间处理</h1><div class="post-meta">Nov 20, 2016<span> | </span><span class="category"><a href="/categories/量化交易/">量化交易</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/11/20/pandas中的时间处理/" href="/2016/11/20/pandas中的时间处理/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="Create-datetime-as-index-in-pandas"><a href="#Create-datetime-as-index-in-pandas" class="headerlink" title="Create datetime as index in pandas"></a>Create datetime as index in pandas</h2><h3 id="read-and-use-dates-as-index"><a href="#read-and-use-dates-as-index" class="headerlink" title="read and use dates as index"></a>read and use dates as index</h3><p><code>pd.read_csv(&#39;hs300.csv&#39;,index_col=&#39;date&#39;,parse_dates=True,thousands=&#39;,&#39;,dtype={&#39;price&#39;:np.float64})</code></p>
<h3 id="Generating-Ranges-of-Timestamps"><a href="#Generating-Ranges-of-Timestamps" class="headerlink" title="Generating Ranges of Timestamps"></a>Generating Ranges of Timestamps</h3><ol>
<li>calendar day: date_range </li>
<li>business day: bdate_range</li>
</ol>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><div class="line"><span class="built_in">from</span> datetime import datetime</div><div class="line"><span class="built_in">start</span> = datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="function"><span class="keyword">end</span>   = <span class="title">datetime</span>(<span class="title">2012</span>, <span class="title">1</span>, <span class="title">1</span>)</span></div><div class="line">ts = pd.date_range(<span class="built_in">start</span>, <span class="keyword">end</span>, freq=<span class="string">'B'</span>)</div></pre></td></tr></table></figure>
<p><img src="https://github.com/fushuyue/DeepLearning/blob/master/pic/pandas.png?raw=true" width="50%" height="50%"></p>
<h3 id="Convert"><a href="#Convert" class="headerlink" title="Convert"></a>Convert</h3><p>To convert a Series or list-like object of date-like objects e.g. strings, epochs, use the <code>to_datetime</code> function</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">pd.to_datetime(pd.Series([<span class="string">'Jul 31, 2009'</span>, <span class="string">'2010-01-10'</span>, <span class="keyword">None</span>]))</div></pre></td></tr></table></figure>
<h2 id="Indexing-with-datetime-in-pandas"><a href="#Indexing-with-datetime-in-pandas" class="headerlink" title="Indexing with datetime in pandas"></a>Indexing with datetime in pandas</h2><h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><p>To provide convenience for accessing longer time series, can pass in the year or year and month as strings:</p>
<ul>
<li>select all data in year 2011: <code>ts[&#39;2011&#39;]</code></li>
<li>select all data in year 2011/06: <code>ts[&#39;2011-6&#39;]</code></li>
<li>select all data from 2013/01 to 2013/02: <code>dft[&#39;2013-1&#39;:&#39;2013-2&#39;]</code></li>
<li>select from 2013/1/1 10:12:00: <code>dft[datetime(2013, 1, 1, 10, 12, 0):datetime(2013, 2, 28, 10, 12, 0)]</code></li>
</ul>
<p>A truncate convenience function is provided that is equivalent to slicing:<br>ts.truncate(before=’10/31/2011’, after=’12/31/2011’)</p>
<h3 id="dateoffset"><a href="#dateoffset" class="headerlink" title="dateoffset"></a>dateoffset</h3><figure class="highlight lsl"><table><tr><td class="code"><pre><div class="line">from datetime import datetime</div><div class="line">from pandas.tseries.offsets import *</div><div class="line">d = datetime(<span class="number">2008</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">9</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line"># plus <span class="number">4</span> month <span class="number">5</span> days</div><div class="line">d + DateOffset(months=<span class="number">4</span>, days=<span class="number">5</span>)</div><div class="line"></div><div class="line"># plus one week</div><div class="line">d + Week()</div></pre></td></tr></table></figure>
<h2 id="Time-series-related-instance-methods¶"><a href="#Time-series-related-instance-methods¶" class="headerlink" title="Time series-related instance methods¶"></a>Time series-related instance methods¶</h2><h3 id="Shifting-lagging"><a href="#Shifting-lagging" class="headerlink" title="Shifting / lagging"></a>Shifting / lagging</h3><p>Shifting without realign of the data: <code>ts.shift(5, freq=&#39;BM&#39;)</code></p>
<h3 id="Resampling"><a href="#Resampling" class="headerlink" title="Resampling"></a>Resampling</h3><p><code>.resample()</code> is a time-based groupby, followed by a reduction method on each of its groups.<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line">start = datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">end   = datetime(<span class="number">2011</span>, <span class="number">3</span>, <span class="number">15</span>)</div><div class="line">ts = pd.date_range(start, end, freq=<span class="string">'B'</span>)</div><div class="line">ts = pd.DataFrame(list(range(len(ts))),index=ts)</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">the how parameter by name, </div><div class="line">including `sum, mean, std, sem, max, min, median, first, last, ohlc`.</div><div class="line">'''</div><div class="line"></div><div class="line">ts.resample(<span class="string">'M'</span>).mean()</div></pre></td></tr></table></figure></p>
<h3 id="Window-Function"><a href="#Window-Function" class="headerlink" title="Window Function"></a>Window Function</h3><p>For working with data, a number of windows functions are provided for computing common window or rolling statistics.<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">s = pd.Series(np.random.randn(<span class="number">1000</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">1000</span>))</div><div class="line">r = s.rolling(window=<span class="number">60</span>)</div><div class="line"></div><div class="line">s.plot(style=<span class="string">'k--'</span>)</div><div class="line">r.mean().plot(style=<span class="string">'k'</span>)</div></pre></td></tr></table></figure></p>
<p>The apply() function takes an extra func argument and performs generic rolling computations.<br>The func argument should be a single function that produces a single value from an ndarray input. </p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line">mad = lambda x: np.fabs(x - x.mean()).mean()</div><div class="line">s.rolling(window=60).apply(mad).plot(style='k')</div></pre></td></tr></table></figure>
<h3 id="Difference-of-resampling-and-window-function"><a href="#Difference-of-resampling-and-window-function" class="headerlink" title="Difference of resampling and window function"></a>Difference of resampling and window function</h3><p>They both operate and perform reductive operations on time-indexed pandas objects.<br>When using .rolling() with an offset. The offset is a time-delta. You will get <code>a same sized result</code> as the input.</p>
<p>When using .resample() with an offset. Construct a <code>new index</code> that is the frequency of the offset. </p>
<p>To summarize, .rolling() is a time-based window operation, while .resample() is a frequency-based window operation.</p>
<h2 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h2><p>A single group can be selected using GroupBy.get_group():<br><code>grouped.get_group(&#39;bar&#39;)</code></p>
<p>With grouped Series you can also pass a list or dict of functions to do aggregation with, outputting a DataFrame:<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">grouped = df.groupby(<span class="string">'A'</span>)</div><div class="line">grouped[<span class="string">'C'</span>].agg([np.sum, np.mean, np.std])</div><div class="line">grouped[<span class="string">'D'</span>].agg(&#123;<span class="string">'result1'</span> : np.sum,</div><div class="line">                  <span class="string">'result2'</span> : np.mean&#125;)</div><div class="line">grouped.agg(&#123;<span class="string">'C'</span> : np.sum,</div><div class="line">             <span class="string">'D'</span> : <span class="keyword">lambda</span> x: np.std(x, ddof=<span class="number">1</span>)&#125;)</div></pre></td></tr></table></figure></p>
<h4 id="The-filter-method-returns-a-subset-of-the-original-object"><a href="#The-filter-method-returns-a-subset-of-the-original-object" class="headerlink" title="The filter method returns a subset of the original object."></a>The filter method returns a subset of the original object.</h4><p>Suppose we want to take only elements that belong to groups with a group sum greater than 2.<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">sf = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>])</div><div class="line">sf.groupby(sf).filter(<span class="keyword">lambda</span> x: x.sum() &gt; <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<h4 id="Apply"><a href="#Apply" class="headerlink" title="Apply"></a>Apply</h4><p>Some operations on the grouped data might not fit into either the aggregate or transform categories.<br><code>grouped[&#39;C&#39;].apply(lambda x: x.describe())</code></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/11/20/pandas中的时间处理/" data-id="ciwd2cvvk0005uk61y8gjv6vl" class="article-share-link">分享到</a><div class="tags"><a href="/tags/python/">python</a><a href="/tags/pandas/">pandas</a></div><div class="post-nav"><a href="/2016/11/20/pandas基本操作/" class="pre">pandas基本操作</a><a href="/2016/11/19/各类机器学习应用/" class="next">各类机器学习应用</a></div><div data-thread-key="2016/11/20/pandas中的时间处理/" data-title="pandas中的时间处理" data-url="http://yoursite.com/2016/11/20/pandas中的时间处理/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/11/20/pandas中的时间处理/" data-title="pandas中的时间处理" data-url="http://yoursite.com/2016/11/20/pandas中的时间处理/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/python爬虫/">python爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/期权/">期权</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化交易/">量化交易</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化投资/">量化投资</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/MFM/" style="font-size: 15px;">MFM</a> <a href="/tags/Adaboost/" style="font-size: 15px;">Adaboost</a> <a href="/tags/RNN/" style="font-size: 15px;">RNN</a> <a href="/tags/LSTM/" style="font-size: 15px;">LSTM</a> <a href="/tags/pandas/" style="font-size: 15px;">pandas</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/threading/" style="font-size: 15px;">threading</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/quant/" style="font-size: 15px;">quant</a> <a href="/tags/multiprocessing/" style="font-size: 15px;">multiprocessing</a> <a href="/tags/cnn/" style="font-size: 15px;">cnn</a> <a href="/tags/cuda/" style="font-size: 15px;">cuda</a> <a href="/tags/urllib/" style="font-size: 15px;">urllib</a> <a href="/tags/择时/" style="font-size: 15px;">择时</a> <a href="/tags/RL/" style="font-size: 15px;">RL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/05/多因子模型/">多因子模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/pandas基本操作/">pandas基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/pandas中的时间处理/">pandas中的时间处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/各类机器学习应用/">各类机器学习应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/Adaboost算法/">Adaboost算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/LSTM模型动作识别/">LSTM模型动作识别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/02/RNN笔记/">RNN笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/26/量化策略评价体系/">量化策略评价体系</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/26/scrapy库学习/">scrapy库学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/26/择时体系梳理/">择时体系梳理</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 关于我</i></div><ul></ul><a href="http://www.github.com/fushuyue" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.linkedin.com/in/fushuyue" title="Linkedin" target="_blank">Linkedin</a><ul></ul><a href="sfu11@illinois.edu" title="Email" target="_blank">Email</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">长海冰茶火.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'fushuyue'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>