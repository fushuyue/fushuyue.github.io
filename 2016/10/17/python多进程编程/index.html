<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>python多进程编程 | 长海冰茶火</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">python多进程编程</h1><a id="logo" href="/.">长海冰茶火</a><p class="description">很惭愧，做了一点微小的工作和笔记</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">python多进程编程</h1><div class="post-meta">Oct 17, 2016<span> | </span><span class="category"><a href="/categories/编程/">编程</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/10/17/python多进程编程/" href="/2016/10/17/python多进程编程/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-The-Process-class"><span class="toc-number">1.</span> <span class="toc-text">1. The Process class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Communication-between-processes"><span class="toc-number">2.</span> <span class="toc-text">2. Communication between processes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Queue-FIFO"><span class="toc-number">2.1.</span> <span class="toc-text">Queue(FIFO)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Pool"><span class="toc-number">3.</span> <span class="toc-text">3. Pool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Sharing-state-between-processes"><span class="toc-number">4.</span> <span class="toc-text">4. Sharing state between processes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Shared-memory"><span class="toc-number">4.1.</span> <span class="toc-text">Shared memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-process"><span class="toc-number">4.2.</span> <span class="toc-text">Server process</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-The-multiprocessing-dummy-module"><span class="toc-number">5.</span> <span class="toc-text">5. The multiprocessing.dummy module</span></a></li></ol></div></div><div class="post-content"><p>由于GIL的存在，python多线程无法完成多核并行运算，因此在处理CPU-bound的工作时，可以利用multiprocessing模块实现多进程编程。与多线程相比，多进程有以下优点：</p>
<ul>
<li>不受GIL限制</li>
<li>在Mac和Linux系统下效率高</li>
</ul>
<h2 id="1-The-Process-class"><a href="#1-The-Process-class" class="headerlink" title="1. The Process class"></a>1. The Process class</h2><p>In multiprocessing, processes are spawned by creating a Process object and then calling its start() method. Process follows the API of threading.Thread. </p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">class multiprocessing.Process()</div><div class="line"></div><div class="line">pid           # Return the process ID</div><div class="line">exitcode      # The child’s exit code.</div><div class="line">terminate()   # Terminate the process.</div><div class="line">daemon        # When a process exits, it attempts to terminate all of its daemonic child processes.</div></pre></td></tr></table></figure>
<p>The multiprocessing module also introduces APIs which do not have analogs in the threading module.</p>
<ul>
<li>Queue and Pipe</li>
<li>Pool</li>
</ul>
<p>Note: on windows, <code>if __name__ == &#39;__main__&#39;</code> is especially important since on windows, this module spawns processes by creating new python interpreter which is different from the fork() method in Unix. And because of this, windows will take more time and resources to spawn processes compared to Unix.</p>
<p>use <code>set_start_method(&#39;spawn&#39;)</code> to set start method</p>
<h2 id="2-Communication-between-processes"><a href="#2-Communication-between-processes" class="headerlink" title="2. Communication between processes"></a>2. Communication between processes</h2><p>Use pipe and queue to avoid having to use any synchronization primitives like locks.</p>
<h3 id="Queue-FIFO"><a href="#Queue-FIFO" class="headerlink" title="Queue(FIFO)"></a>Queue(FIFO)</h3><p><code>class multiprocessing.Queue([maxsize])</code><br><figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">qsize()          <span class="comment"># Return the approximate size of the queue</span></div><div class="line">empty()/full()   </div><div class="line"><span class="keyword">put</span>(obj[, block[, <span class="keyword">timeout</span>]])</div><div class="line"><span class="keyword">get</span>([block[, <span class="keyword">timeout</span>]])    <span class="comment"># Remove and return an item from the queue</span></div><div class="line">close()          <span class="comment"># Indicate that no more data will be put on this queue by the current process</span></div><div class="line">join_thread()    <span class="comment"># Join the background thread after called close()</span></div><div class="line">cancel_join_thread()</div></pre></td></tr></table></figure></p>
<p>Queue example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(q)</span>:</span></div><div class="line">    q.put([<span class="number">42</span>, <span class="keyword">None</span>, <span class="string">'hello'</span>])</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    q = Queue()</div><div class="line">    p = Process(target=f, args=(q,))</div><div class="line">    p.start()</div><div class="line">    print(q.get())    <span class="comment"># prints "[42, None, 'hello']"</span></div><div class="line">    p.join()</div></pre></td></tr></table></figure>
<h2 id="3-Pool"><a href="#3-Pool" class="headerlink" title="3. Pool"></a>3. Pool</h2><p>The Pool class represents a pool of worker processes. It has methods which allows tasks to be offloaded to the worker processes in a few different ways.</p>
<p>One can create a pool of processes which will carry out tasks submitted to it with the Pool class.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">multiprocessing</span>.<span class="title">pool</span>.<span class="title">Pool</span><span class="params">()</span></span></div></pre></td></tr></table></figure>
<p>If you need to run a function in a separate process, but want the current process to block until that function returns, use <code>map</code> or <code>apply</code>, otherwise, use <code>map_async</code> or <code>apply_async</code>.</p>
<p><code>map(func, iterable[, chunksize])</code>: same like <code>map</code> function,     applies the same function to many arguments.</p>
<p><code>map_async(func[, args[, kwds[, callback[, error_callback]]]])</code>: call returns immediately instead of waiting for the result. You call its <code>get()</code> method to retrieve the result of the function call. When the function is complete, <code>callback()</code> is called. This can be used instead of calling <code>get()</code>.</p>
<p>An example of callback function:<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo_pool</span><span class="params">(x)</span>:</span></div><div class="line">    time.sleep(<span class="number">2</span>)</div><div class="line">    <span class="keyword">return</span> x*x</div><div class="line"></div><div class="line">result_list = []</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_result</span><span class="params">(result)</span>:</span></div><div class="line">    <span class="comment"># This is called whenever foo_pool(i) returns a result.</span></div><div class="line">    <span class="comment"># result_list is modified only by the main process, not the pool workers.</span></div><div class="line">    result_list.append(result)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">apply_async_with_callback</span><span class="params">()</span>:</span></div><div class="line">    pool = mp.Pool()</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">        pool.apply_async(foo_pool, args = (i, ), callback = log_result)</div><div class="line">    pool.close()</div><div class="line">    pool.join()</div><div class="line">    print(result_list)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    apply_async_with_callback()</div></pre></td></tr></table></figure></p>
<p><code>starmap_async(func, iterable[, chunksize])</code>: Like <code>map()</code> except that the elements of the iterable are expected to be iterables that are unpacked as arguments.</p>
<p>An example of starmap_async:<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</div><div class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> repeat</div><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, freeze_support</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b)</span>:</span></div><div class="line">    <span class="keyword">return</span> a + b</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    a_args = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">    second_arg = <span class="number">1</span></div><div class="line">    <span class="keyword">with</span> Pool() <span class="keyword">as</span> pool:</div><div class="line">    	<span class="comment"># use startmap</span></div><div class="line">        L = pool.starmap(func, [(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">3</span>, <span class="number">1</span>)])</div><div class="line">        M = pool.starmap(func, zip(a_args, repeat(second_arg)))</div><div class="line"></div><div class="line">        <span class="comment"># use partial function</span></div><div class="line">        N = pool.map(partial(func, b=second_arg), a_args)</div><div class="line">        <span class="keyword">assert</span> L == M == N</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</div><div class="line">    freeze_support()</div><div class="line">    main()</div></pre></td></tr></table></figure></p>
<h2 id="4-Sharing-state-between-processes"><a href="#4-Sharing-state-between-processes" class="headerlink" title="4. Sharing state between processes"></a>4. Sharing state between processes</h2><h3 id="Shared-memory"><a href="#Shared-memory" class="headerlink" title="Shared memory"></a>Shared memory</h3><p>Using <code>Value</code> and <code>Array</code> to share data:<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Value, Array</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(n, a)</span>:</span></div><div class="line">    n.value = <span class="number">3.1415927</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</div><div class="line">        a[i] = -a[i]</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    num = Value(<span class="string">'d'</span>, <span class="number">0.0</span>)</div><div class="line">    arr = Array(<span class="string">'i'</span>, range(<span class="number">10</span>))</div><div class="line"></div><div class="line">    p = Process(target=f, args=(num, arr))</div><div class="line">    p.start()</div><div class="line">    p.join()</div><div class="line"></div><div class="line">    print(num.value)</div><div class="line">    print(arr[:])</div></pre></td></tr></table></figure></p>
<h3 id="Server-process"><a href="#Server-process" class="headerlink" title="Server process"></a>Server process</h3><p>A manager object returned by Manager() controls a server process which holds Python objects and allows other processes to manipulate them using proxies.<br>Server process managers are more flexible than using shared memory objects because they can be made to support arbitrary object types. Also, a single manager can be shared by processes on different computers over a network. They are, however, slower than using shared memory.</p>
<h2 id="5-The-multiprocessing-dummy-module"><a href="#5-The-multiprocessing-dummy-module" class="headerlink" title="5. The multiprocessing.dummy module"></a>5. The multiprocessing.dummy module</h2><p>multiprocessing.dummy replicates the API of multiprocessing but is no more than a wrapper around the threading module.</p>
<p>Test the efficiency of multithreading and multiprocessing<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</div><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">urls = [</div><div class="line">    <span class="string">'http://www.python.org'</span>, </div><div class="line">    <span class="string">'http://www.python.org/about/'</span>,</div><div class="line">    <span class="string">'http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html'</span>,</div><div class="line">    <span class="string">'http://www.python.org/doc/'</span>,</div><div class="line">    <span class="string">'http://www.python.org/download/'</span>,</div><div class="line">    <span class="string">'http://www.python.org/getit/'</span>,</div><div class="line">    <span class="string">'http://www.python.org/community/'</span>,</div><div class="line">    <span class="string">'https://wiki.python.org/moin/'</span>,</div><div class="line">    <span class="string">'http://planet.python.org/'</span>,</div><div class="line">    <span class="string">'https://wiki.python.org/moin/LocalUserGroups'</span>,</div><div class="line">    <span class="string">'http://www.python.org/psf/'</span>,</div><div class="line">    <span class="string">'http://docs.python.org/devguide/'</span>,</div><div class="line">    <span class="string">'http://www.python.org/community/awards/'</span> </div><div class="line">    ]</div><div class="line"></div><div class="line">t1 = time.time()</div><div class="line"><span class="comment"># Make the Pool of workers </span></div><div class="line"><span class="keyword">with</span> ThreadPool(<span class="number">8</span>) <span class="keyword">as</span> thread_pool:</div><div class="line">	results = thread_pool.map_async(urlopen, urls)</div><div class="line">thread_pool.join()</div><div class="line">t2 = time.time()</div><div class="line">print(<span class="string">"threading use &#123;&#125; seconds"</span>.format(t2-t1))</div><div class="line"></div><div class="line">t3 = time.time()</div><div class="line"><span class="keyword">with</span> Pool(<span class="number">8</span>) <span class="keyword">as</span> process_pool:</div><div class="line">	results = process_pool.map_async(urlopen, urls)</div><div class="line">process_pool.join()</div><div class="line">t4 = time.time()</div><div class="line">print(<span class="string">"multiprocessing use &#123;&#125; seconds"</span>.format(t4-t3))</div></pre></td></tr></table></figure></p>
<p>Result:<br><figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line">threading <span class="keyword">use</span> <span class="number">0.10493803024291992</span> seconds</div><div class="line">multiprocessing <span class="keyword">use</span> <span class="number">0.1377570629119873</span> seconds</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/10/17/python多进程编程/" data-id="cj74l8rmc000hqi61zwg2n3bn" class="article-share-link">分享到</a><div class="tags"><a href="/tags/python/">python</a><a href="/tags/multiprocessing/">multiprocessing</a></div><div class="post-nav"><a href="/2016/10/19/复权问题处理/" class="pre">复权问题处理</a><a href="/2016/10/16/python_With_statement/" class="next">With statement in python</a></div><div data-thread-key="2016/10/17/python多进程编程/" data-title="python多进程编程" data-url="http://yoursite.com/2016/10/17/python多进程编程/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/10/17/python多进程编程/" data-title="python多进程编程" data-url="http://yoursite.com/2016/10/17/python多进程编程/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/python爬虫/">python爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/期权/">期权</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化交易/">量化交易</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化投资/">量化投资</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/multiprocessing/" style="font-size: 15px;">multiprocessing</a> <a href="/tags/Adaboost/" style="font-size: 15px;">Adaboost</a> <a href="/tags/CTA/" style="font-size: 15px;">CTA</a> <a href="/tags/quant/" style="font-size: 15px;">quant</a> <a href="/tags/RNN/" style="font-size: 15px;">RNN</a> <a href="/tags/LSTM/" style="font-size: 15px;">LSTM</a> <a href="/tags/pandas/" style="font-size: 15px;">pandas</a> <a href="/tags/threading/" style="font-size: 15px;">threading</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/urllib/" style="font-size: 15px;">urllib</a> <a href="/tags/cnn/" style="font-size: 15px;">cnn</a> <a href="/tags/cuda/" style="font-size: 15px;">cuda</a> <a href="/tags/Computer/" style="font-size: 15px;">Computer</a> <a href="/tags/MFM/" style="font-size: 15px;">MFM</a> <a href="/tags/择时/" style="font-size: 15px;">择时</a> <a href="/tags/RL/" style="font-size: 15px;">RL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/03/在不同电脑上更新blog/">多因子模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/10/单因子检验概述/">单因子检验概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/04/CTA策略设计流程/">CTA策略设计流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/期货市场概述/">期货市场概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/05/多因子模型/">多因子模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/pandas基本操作/">pandas基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/pandas中的时间处理/">pandas中的时间处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/各类机器学习应用/">各类机器学习应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/Adaboost算法/">Adaboost算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/LSTM模型动作识别/">LSTM模型动作识别</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 关于我</i></div><ul></ul><a href="http://www.github.com/fushuyue" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.linkedin.com/in/fushuyue" title="Linkedin" target="_blank">Linkedin</a><ul></ul><a href="sfu11@illinois.edu" title="Email" target="_blank">Email</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">长海冰茶火.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'fushuyue'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>